<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MECHANIC | EXPLOITATION CORE</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #030305;
            --panel: #08080a;
            --accent: #ff003c;
            /* Neon Red/Pink */
            --accent-glow: rgba(255, 0, 60, 0.4);
            --accent-soft: rgba(255, 0, 60, 0.1);
            --text: #ffffff;
            --text-dim: #4a4a4f;
            --success: #00ffaa;
            --warning: #ffcc00;
            --danger: #ff003c;
        }

        * {
            cursor: crosshair;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background-image:
                radial-gradient(circle at 50% 50%, #101015 0%, transparent 100%),
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 100%, 100% 4px, 100% 100%;
        }

        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.05);
            opacity: 0.1;
            z-index: 100;
            pointer-events: none;
            animation: scanline 8s linear infinite;
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100vh);
            }

            100% {
                transform: translateY(100vh);
            }
        }

        .main-container {
            width: 1100px;
            height: 750px;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 20px;
            padding: 20px;
            background: rgba(10, 10, 12, 0.8);
            border: 1px solid #1a1a20;
            border-radius: 4px;
            /* Industrial Sharpness */
            backdrop-filter: blur(20px);
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 1);
        }

        .main-container::after {
            content: 'UNIT-01 // MECHANIC ENGINE';
            position: absolute;
            bottom: -25px;
            left: 0;
            font-family: 'JetBrains Mono';
            font-size: 0.6rem;
            color: var(--text-dim);
            letter-spacing: 2px;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
            padding-right: 20px;
            border-right: 1px solid #1a1a20;
        }

        h1 {
            font-weight: 900;
            font-size: 3rem;
            margin: 0;
            letter-spacing: -3px;
            font-style: italic;
            color: #fff;
            text-shadow: 2px 2px 0px var(--accent);
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 10px var(--success);
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .input-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-family: 'JetBrains Mono';
            font-size: 0.65rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input {
            background: #000;
            border: 1px solid #222;
            padding: 15px;
            color: #fff;
            font-family: 'JetBrains Mono';
            font-size: 0.85rem;
            transition: 0.2s;
            border-radius: 2px;
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-soft);
        }

        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-launch {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 25px;
            font-family: 'Outfit';
            font-weight: 900;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: auto;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 70%, 90% 100%, 0 100%);
            transition: 0.2s;
        }

        .btn-launch:hover:not(:disabled) {
            transform: scale(1.02);
            filter: brightness(1.2);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        .btn-launch:active {
            transform: scale(0.98);
        }

        .btn-launch:disabled {
            background: #1a1a1a;
            color: #333;
            clip-path: none;
        }

        /* --- DASHBOARD --- */
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: #000;
            border: 1px solid #1a1a20;
            padding: 20px;
            position: relative;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
        }

        .stat-meta {
            font-family: 'JetBrains Mono';
            font-size: 0.6rem;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-top: 5px;
            font-family: 'JetBrains Mono';
        }

        .console-container {
            flex-grow: 1;
            background: #000;
            border: 1px solid #1a1a20;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .console-header {
            background: #0a0a0f;
            padding: 10px 15px;
            font-family: 'JetBrains Mono';
            font-size: 0.6rem;
            color: var(--text-dim);
            border-bottom: 1px solid #1a1a20;
            display: flex;
            justify-content: space-between;
        }

        #console-output {
            padding: 15px;
            font-family: 'JetBrains Mono';
            font-size: 0.75rem;
            color: #00ffaa;
            overflow-y: auto;
            text-shadow: 0 0 5px rgba(0, 255, 170, 0.4);
            display: flex;
            flex-direction: column-reverse;
        }

        .log-entry {
            margin-bottom: 4px;
        }

        .log-time {
            color: #444;
            margin-right: 10px;
        }

        .log-tag {
            font-weight: 700;
            margin-right: 10px;
        }

        .tag-exe {
            color: var(--warning);
        }

        .tag-res {
            color: var(--success);
        }

        .tag-err {
            color: var(--danger);
        }

        .loading-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: var(--accent);
            width: 0%;
            transition: 0.3s;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        /* --- DECOR --- */
        .corner-decor {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent);
        }

        .c-tl {
            top: -2px;
            left: -2px;
            border-right: none;
            border-bottom: none;
        }

        .c-tr {
            top: -2px;
            right: -2px;
            border-left: none;
            border-bottom: none;
        }

        .c-bl {
            bottom: -2px;
            left: -2px;
            border-right: none;
            border-top: none;
        }

        .c-br {
            bottom: -2px;
            right: -2px;
            border-left: none;
            border-top: none;
        }
    </style>
</head>

<body>

    <div class="scanline"></div>

    <div class="main-container">
        <div class="c-tl corner-decor"></div>
        <div class="c-tr corner-decor"></div>
        <div class="c-bl corner-decor"></div>
        <div class="c-br corner-decor"></div>

        <!-- CONFIG -->
        <div class="side-panel">
            <h1>MECHANIC</h1>
            <div style="font-size: 0.7rem; color: var(--text-dim); letter-spacing: 2px;">
                <span class="status-dot"></span> SYSTEM ONLINE // V3.0
            </div>

            <div class="input-box">
                <label>Target Entry (URL or IP)</label>
                <input type="text" id="target" value="1.1.1.1" placeholder="example.com">
            </div>

            <div class="control-grid">
                <div class="input-box">
                    <label>Workers</label>
                    <input type="number" id="workers" value="100">
                </div>
                <div class="input-box">
                    <label>Requests</label>
                    <input type="number" id="requests" value="1000">
                </div>
            </div>

            <div class="input-box">
                <label>Engine API Link</label>
                <input type="text" id="apiLink" placeholder="https://koyeb-app-url">
            </div>

            <button class="btn-launch" id="launchBtn">ENGAGE CORE</button>
        </div>

        <!-- VISUALS -->
        <div class="dashboard">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-meta">Success / Loss</div>
                    <div class="stat-value" id="res-rate">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-meta">Response Delay</div>
                    <div class="stat-value" id="res-time">0<span style="font-size: 1rem">MS</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-meta">Total Objects</div>
                    <div class="stat-value" id="res-count">0</div>
                </div>
            </div>

            <div class="console-container">
                <div class="console-header">
                    <span>> TERMINAL_OUTPUT</span>
                    <span id="uptime">00:00:00</span>
                </div>
                <div id="console-output">
                    <div class="log-entry">AWAITING TARGET COMMAND...</div>
                </div>
                <div class="loading-bar" id="loadBar"></div>
            </div>
        </div>
    </div>

    <script>
        const launchBtn = document.getElementById('launchBtn');
        const consoleOut = document.getElementById('console-output');
        const loadBar = document.getElementById('loadBar');
        const apiInput = document.getElementById('apiLink');

        // Auto-save API Link
        if (localStorage.getItem('m_api')) apiInput.value = localStorage.getItem('m_api');

        function addLog(msg, type = '') {
            const time = new Date().toLocaleTimeString('en-GB', { hour12: false });
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            let tag = '';
            if (type) tag = `<span class="log-tag tag-${type}">[${type.toUpperCase()}]</span>`;

            entry.innerHTML = `<span class="log-time">${time}</span>${tag}${msg}`;
            consoleOut.prepend(entry);
        }

        launchBtn.onclick = async () => {
            const api = apiInput.value.trim();
            if (!api) return addLog("CRITICAL: API LINK MISSING", "err");
            localStorage.setItem('m_api', api);

            const body = {
                url: document.getElementById('target').value,
                concurrency: parseInt(document.getElementById('workers').value),
                count: parseInt(document.getElementById('requests').value)
            };

            launchBtn.disabled = true;
            launchBtn.innerText = "STREAMING...";
            loadBar.style.width = "5%";

            addLog(`PREPARING SEQUENCE: ${body.url}`, "exe");
            addLog(`SPAWNING ${body.concurrency} WORKERS FOR ${body.count} CYCLES...`);

            try {
                // Use streaming endpoint for real-time updates
                const response = await fetch(`${api}/api/probe-stream`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`CORE ERROR ${response.status}: ${text.substring(0, 50)}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n\n');
                    buffer = lines.pop();

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.substring(6));

                            // Update progress bar
                            const progress = (data.progress / data.total) * 100;
                            loadBar.style.width = `${progress}%`;

                            // Update stats live
                            if (data.success !== undefined) {
                                const rate = data.total > 0 ? ((data.success / (data.progress || data.total)) * 100).toFixed(1) : 0;
                                document.getElementById('res-rate').innerText = `${rate}%`;
                                document.getElementById('res-time').innerHTML = `${data.latency_ms}<span style="font-size: 1rem">MS</span>`;
                                document.getElementById('res-count').innerText = data.progress || data.success + data.errors;
                            }

                            if (data.done) {
                                addLog(`SEQUENCE COMPLETE: ${data.success} OK / ${data.errors} ERR`, "res");
                                addLog(`FINAL LATENCY: ${data.latency_ms}ms`);
                            }
                        }
                    }
                }

                loadBar.style.width = "100%";

            } catch (err) {
                addLog(`DEPLOYMENT FAILED: ${err.message}`, "err");
                loadBar.style.backgroundColor = "var(--danger)";
            } finally {
                launchBtn.disabled = false;
                launchBtn.innerText = "ENGAGE CORE";
                setTimeout(() => { loadBar.style.width = "0%"; loadBar.style.backgroundColor = "var(--accent)"; }, 3000);
            }
        };

        // Fake Uptime
        setInterval(() => {
            const now = new Date();
            document.getElementById('uptime').innerText = now.toLocaleTimeString('en-GB');
        }, 1000);
    </script>
</body>

</html>